<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1v1 语音社交匹配</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body class="text-white">
    <!-- 数据流动画背景 -->
    <div class="data-stream" style="animation-delay: 0s;"></div>
    <div class="data-stream" style="animation-delay: 2s;"></div>
    <div class="data-stream" style="animation-delay: 4s;"></div>
    <div class="data-stream" style="animation-delay: 6s;"></div>

    <!-- 需求输入页面 -->
    <div id="entryPage" class="page min-h-screen flex items-center justify-center p-6 scan-lines relative">
        <div class="max-w-md w-full">
            <div class="text-center mb-12">
                <div class="w-24 h-24 mx-auto mb-8 cyber-border cyber-glow rounded-full flex items-center justify-center relative">
                    <i class="fas fa-microchip text-4xl neon-cyan"></i>
                    <div class="absolute inset-0 rounded-full border-2 border-cyan-400 animate-spin" style="animation-duration: 8s;"></div>
                </div>
                <h1 class="cyber-title text-5xl font-bold mb-6 neon-cyan">
                    NEURAL LINK
                </h1>
                <p class="cyber-text text-xl cyber-text-pink-readable opacity-90">连接数字灵魂 • 探索赛博空间</p>
            </div>
            
            <div class="space-y-8">
                <!-- 需求输入框 -->
                <div class="relative">
                    <textarea 
                        id="demandInput"
                        placeholder="输入你的数据流..."
                        maxlength="50"
                        rows="4"
                        class="cyber-input w-full p-6 rounded-xl resize-none focus:outline-none placeholder-cyan-400"
                    ></textarea>
                    <div class="absolute bottom-4 right-4">
                        <span id="charCount" class="text-sm neon-green">0/50</span>
                    </div>
                    <div class="absolute top-2 left-2">
                        <span class="text-xs neon-cyan opacity-60">[DATA_INPUT]</span>
                    </div>
                </div>
                
                <!-- 麦克风权限状态 -->
                <div id="micStatus" class="flex items-center justify-center space-x-4 p-4 cyber-border rounded-xl cyber-glow">
                    <div id="micIcon" class="cyber-status-dot bg-gray-500"></div>
                    <span id="micText" class="cyber-text cyber-text-cyan-readable">正在检测音频接口...</span>
                </div>
                
                <!-- 匹配选项 -->
                <div class="space-y-6">
                    <button 
                        id="startMatchBtn"
                        disabled
                        class="cyber-button w-full py-4 px-6 rounded-xl font-bold text-lg text-cyan-400 shadow-lg relative"
                    >
                        <i class="fas fa-users mr-3"></i>
                        NEURAL MATCHING
                    </button>
                    
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-cyan-600 opacity-50"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-4 bg-gray-900 cyber-text cyber-text-pink-readable">[OR_EXECUTE]</span>
                        </div>
                    </div>
                    
                    <button 
                        id="chatWithAIBtn"
                        disabled
                        class="cyber-ai-button cyber-button w-full py-4 px-6 rounded-xl font-bold text-lg text-pink-400 shadow-lg relative"
                    >
                        <i class="fas fa-robot mr-3"></i>
                        AI INTERFACE
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 匹配页面 -->
    <div id="matchingPage" class="page hidden min-h-screen flex items-center justify-center p-6 scan-lines relative">
        <div class="text-center max-w-md w-full">
            <!-- 波纹动画 -->
            <div class="relative mb-12">
                <div class="w-48 h-48 mx-auto relative">
                    <div class="absolute inset-0 cyber-pulse-ring"></div>
                    <div class="absolute inset-4 cyber-pulse-ring" style="animation-delay: 0.5s; border-color: #ff00ff;"></div>
                    <div class="absolute inset-8 cyber-pulse-ring" style="animation-delay: 1s; border-color: #00ff41;"></div>
                    <div class="w-24 h-24 cyber-border cyber-glow rounded-full absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center">
                        <i class="fas fa-search text-3xl neon-pink animate-pulse"></i>
                    </div>
                </div>
            </div>
            
            <h2 class="cyber-title text-4xl font-bold mb-6 neon-cyan">SCANNING NETWORK...</h2>
            <p class="cyber-text text-xl mb-8 cyber-text-green-readable">
                在线节点: <span id="onlineCount" class="neon-pink font-bold">12</span>
            </p>
            
            <!-- 用户需求预览 -->
            <div class="cyber-border cyber-glow rounded-xl p-6 mb-8 relative">
                <div class="absolute top-2 left-2">
                    <span class="text-xs neon-cyan opacity-60">[USER_DATA]</span>
                </div>
                <p class="text-sm neon-green mb-2">数据包内容</p>
                <p id="demandPreview" class="cyber-text text-lg font-medium neon-cyan"></p>
            </div>
            
            <button id="cancelMatchBtn" class="cyber-button px-8 py-3 rounded-xl neon-pink border-2 border-pink-500 hover:border-red-500 transition-colors">
                <i class="fas fa-times mr-2"></i>
                ABORT SCAN
            </button>
        </div>
    </div>

    <!-- 语音通话页面 -->
    <div id="callPage" class="page hidden min-h-screen flex flex-col scan-lines relative">
        <!-- 顶部信息区域 -->
        <div class="flex-1 flex flex-col items-center justify-center p-8">
            <!-- 对方需求显示 -->
            <div class="cyber-border cyber-glow rounded-xl p-6 mb-8 max-w-md w-full text-center relative">
                <div class="absolute top-2 left-2">
                    <span class="text-xs neon-cyan opacity-60">[PEER_DATA]</span>
                </div>
                <p class="text-sm neon-green mb-2">对方数据流</p>
                <p id="partnerDemand" class="cyber-text text-lg neon-cyan font-medium">正在建立连接...</p>
            </div>
            
            <!-- 计时器 -->
            <div class="relative mb-8">
                <svg class="w-64 h-64 transform -rotate-90" viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="45" stroke="rgba(0, 255, 255, 0.2)" stroke-width="2" fill="none"/>
                    <circle 
                        id="timerCircle"
                        cx="50" cy="50" r="45" 
                        stroke="currentColor" 
                        stroke-width="4" 
                        fill="none" 
                        class="neon-cyan cyber-timer-circle"
                        stroke-linecap="round"
                    />
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="text-center">
                        <div id="timeDisplay" class="cyber-title text-6xl font-bold neon-pink">01:00</div>
                        <div class="cyber-text text-sm neon-green mt-2">[CONNECTION_TIME]</div>
                    </div>
                </div>
            </div>
            
            <!-- 语音可视化 -->
            <div class="cyber-voice-visualizer mb-8">
                <div class="w-3 h-8 rounded-full cyber-wave-bar" style="animation-delay: 0s;"></div>
                <div class="w-3 h-12 rounded-full cyber-wave-bar" style="animation-delay: 0.2s;"></div>
                <div class="w-3 h-6 rounded-full cyber-wave-bar" style="animation-delay: 0.4s;"></div>
                <div class="w-3 h-16 rounded-full cyber-wave-bar" style="animation-delay: 0.6s;"></div>
                <div class="w-3 h-10 rounded-full cyber-wave-bar" style="animation-delay: 0.8s;"></div>
                <div class="w-3 h-14 rounded-full cyber-wave-bar" style="animation-delay: 1s;"></div>
                <div class="w-3 h-8 rounded-full cyber-wave-bar" style="animation-delay: 1.2s;"></div>
            </div>
        </div>
        
        <!-- 底部控制按钮 -->
        <div class="flex justify-center space-x-12 pb-8">
            <button id="muteBtn" class="w-20 h-20 cyber-border cyber-glow rounded-full flex items-center justify-center transition-all hover:scale-110">
                <i class="fas fa-microphone text-2xl neon-cyan"></i>
            </button>
            <button id="hangupBtn" class="w-20 h-20 border-2 border-red-500 rounded-full flex items-center justify-center transition-all hover:scale-110 hover:bg-red-500 hover:bg-opacity-20">
                <i class="fas fa-phone-slash text-2xl text-red-400"></i>
            </button>
        </div>
    </div>

    <!-- AI对话页面 -->
    <div id="aiChatPage" class="page hidden min-h-screen flex flex-col scan-lines relative">
        <!-- 顶部导航 -->
        <div class="bg-gradient-to-r from-black via-gray-900 to-black text-white px-6 py-4 cyber-border border-b-2 border-cyan-500">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 cyber-border cyber-glow rounded-full flex items-center justify-center">
                        <i class="fas fa-brain text-xl neon-pink"></i>
                    </div>
                    <div>
                        <h1 class="cyber-title text-xl font-bold neon-cyan">AI NEURAL INTERFACE</h1>
                        <p class="cyber-text text-sm neon-green" id="aiStatusText">系统就绪</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="aiSettingsBtn" class="p-3 cyber-border rounded-lg hover:cyber-glow transition-all">
                        <i class="fas fa-cog text-lg neon-cyan"></i>
                    </button>
                    <button id="backToHomeBtn" class="p-3 cyber-border rounded-lg hover:cyber-glow transition-all">
                        <i class="fas fa-arrow-left text-lg neon-pink"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 聊天消息区域 -->
        <div class="flex-1 overflow-hidden relative">
            <div id="aiChatContainer" class="h-full overflow-y-auto p-6 space-y-6">
                <!-- 欢迎消息 -->
                <div class="flex justify-start">
                    <div class="cyber-border cyber-glow px-6 py-4 rounded-2xl rounded-bl-md max-w-xs lg:max-w-md shadow-lg bg-gradient-to-r from-purple-900 to-pink-900">
                        <div class="cyber-text font-medium neon-cyan">你好！我是AI助手</div>
                        <div class="cyber-text text-sm neon-green mt-1">基于你的需求：<span id="aiUserDemand" class="font-semibold neon-pink"></span></div>
                        <div class="cyber-text text-sm neon-green mt-1">有什么可以帮助你的吗？</div>
                        <div class="text-xs neon-cyan opacity-70 mt-2">刚刚</div>
                    </div>
                </div>
            </div>
            
            <!-- AI正在输入指示器 -->
            <div id="aiTypingIndicator" class="hidden px-6 py-3">
                <div class="flex justify-start">
                    <div class="cyber-border cyber-glow px-4 py-3 rounded-2xl rounded-bl-md max-w-xs bg-gradient-to-r from-purple-900 to-pink-900">
                        <div class="flex items-center space-x-3">
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 bg-cyan-400 rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                                <div class="w-2 h-2 bg-pink-400 rounded-full animate-bounce" style="animation-delay: 0.1s;"></div>
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                            </div>
                            <span class="cyber-text text-sm neon-green">AI正在处理数据...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 消息输入区域 -->
        <div class="border-t-2 border-cyan-500 bg-black bg-opacity-80 backdrop-blur-lg px-6 py-4">
            <div class="flex items-end space-x-4 max-w-4xl mx-auto">
                <div class="flex-1 relative">
                    <textarea 
                        id="aiMessageInput" 
                        placeholder="输入数据流..." 
                        rows="1"
                        class="cyber-input w-full resize-none px-6 py-4 rounded-2xl focus:outline-none transition-all duration-300"
                    ></textarea>
                </div>
                <button 
                    id="aiSendBtn" 
                    class="w-14 h-14 cyber-border cyber-glow rounded-full flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <i class="fas fa-paper-plane text-lg neon-cyan"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- AI设置面板 -->
    <div id="aiSettingsPanel" class="fixed top-0 right-0 h-full w-96 bg-black bg-opacity-95 backdrop-blur-lg shadow-2xl z-50 transform translate-x-full transition-transform duration-300 overflow-y-auto cyber-border border-l-2 border-cyan-500">
        <div class="p-6">
            <!-- 设置面板头部 -->
            <div class="flex items-center justify-between mb-8">
                <h2 class="cyber-title text-2xl font-bold neon-cyan flex items-center">
                    <i class="fas fa-cog mr-3 neon-pink"></i>
                    SYSTEM CONFIG
                </h2>
                <button id="closeAISettingsBtn" class="p-2 cyber-border rounded-full hover:cyber-glow transition-all">
                    <i class="fas fa-times text-xl neon-pink"></i>
                </button>
            </div>

            <!-- API 配置区域 -->
            <div class="space-y-6">
                <div class="cyber-border cyber-glow rounded-2xl p-6 bg-gradient-to-br from-purple-900 to-pink-900 bg-opacity-30">
                    <h3 class="cyber-title text-lg font-semibold neon-green mb-4 flex items-center">
                        <i class="fas fa-server mr-2 neon-cyan"></i>
                        API INTERFACE
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block cyber-text text-sm font-medium neon-cyan mb-2">
                                <i class="fas fa-link mr-1 neon-pink"></i>
                                API 地址
                            </label>
                            <input 
                                type="url" 
                                id="aiApiUrl" 
                                placeholder="https://api.openai.com/v1/chat/completions"
                                class="cyber-input w-full px-4 py-3 rounded-xl focus:outline-none transition-colors"
                            >
                        </div>
                        
                        <div>
                            <label class="block cyber-text text-sm font-medium neon-cyan mb-2">
                                <i class="fas fa-key mr-1 neon-pink"></i>
                                API 密钥
                            </label>
                            <div class="relative">
                                <input 
                                    type="password" 
                                    id="aiApiKey" 
                                    placeholder="输入您的API密钥..."
                                    class="cyber-input w-full px-4 py-3 pr-12 rounded-xl focus:outline-none transition-colors"
                                >
                                <button type="button" id="toggleAIApiKey" class="absolute right-3 top-1/2 transform -translate-y-1/2 neon-green hover:neon-pink transition-colors">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block cyber-text text-sm font-medium neon-cyan mb-2">
                                <i class="fas fa-brain mr-1 neon-pink"></i>
                                模型名称
                            </label>
                            <input 
                                type="text" 
                                id="aiModelName" 
                                placeholder="gpt-3.5-turbo"
                                class="cyber-input w-full px-4 py-3 rounded-xl focus:outline-none transition-colors"
                            >
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="space-y-3">
                    <button 
                        id="saveAIConfigBtn" 
                        class="cyber-button w-full py-4 px-6 rounded-xl transition-all duration-300 flex items-center justify-center space-x-2 shadow-lg neon-cyan border-2 border-cyan-500"
                    >
                        <i class="fas fa-save"></i>
                        <span>SAVE CONFIG</span>
                    </button>
                    
                    <button 
                        id="testAIConnectionBtn" 
                        class="cyber-button w-full py-4 px-6 rounded-xl transition-all duration-300 flex items-center justify-center space-x-2 shadow-lg neon-green border-2 border-green-500"
                    >
                        <i class="fas fa-plug"></i>
                        <span>TEST CONNECTION</span>
                    </button>
                    
                    <button 
                        id="clearAIChatBtn" 
                        class="cyber-button w-full py-4 px-6 rounded-xl transition-all duration-300 flex items-center justify-center space-x-2 shadow-lg neon-pink border-2 border-pink-500"
                    >
                        <i class="fas fa-broom"></i>
                        <span>CLEAR DATA</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI设置面板遮罩 -->
    <div id="aiOverlay" class="fixed inset-0 cyber-modal-backdrop z-40 opacity-0 invisible transition-all duration-300"></div>
    
    <!-- 续聊弹窗 -->
    <div id="extensionModal" class="fixed inset-0 cyber-modal-backdrop hidden flex items-center justify-center z-50 p-4">
        <div class="cyber-modal-content rounded-2xl p-8 max-w-sm w-full shadow-2xl">
            <div class="text-center">
                <div class="w-20 h-20 mx-auto mb-6 cyber-border cyber-glow rounded-full flex items-center justify-center">
                    <i class="fas fa-heart text-3xl neon-pink animate-pulse"></i>
                </div>
                <h3 class="cyber-title text-2xl font-bold mb-4 neon-cyan">EXTEND CONNECTION?</h3>
                <p class="cyber-text neon-green mb-6">决策时间: <span id="decisionTimer" class="neon-pink font-bold">10</span> 秒</p>
                
                <div class="flex space-x-4 mb-6">
                    <button id="agreeBtn" class="flex-1 py-3 cyber-button rounded-xl font-semibold neon-green border-2 border-green-500 hover:cyber-glow transition-all">
                        <i class="fas fa-heart mr-2"></i>
                        ACCEPT
                    </button>
                    <button id="declineBtn" class="flex-1 py-3 cyber-button rounded-xl font-semibold neon-pink border-2 border-red-500 hover:cyber-glow transition-all">
                        <i class="fas fa-times mr-2"></i>
                        DECLINE
                    </button>
                </div>
                
                <!-- 双方状态显示 -->
                <div class="flex justify-between cyber-text text-sm neon-cyan">
                    <div class="flex items-center space-x-2">
                        <div id="myStatus" class="cyber-status-dot bg-gray-400"></div>
                        <span>YOU</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span>PEER</span>
                        <div id="partnerStatus" class="cyber-status-dot bg-gray-400"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="app.js"></script>
    <!-- 测试脚本 - 仅用于开发测试 -->
    <script src="../test-users.js"></script>
    <!-- 数据库初始化脚本 -->
    <script src="../init-db.js"></script>
</body>
</html>